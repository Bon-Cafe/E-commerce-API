<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Store</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #e74c3c; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
        .navbar { background-color: var(--primary-color); }
        .card { border: none; transition: transform 0.2s; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card:hover { transform: translateY(-5px); }
        .btn-primary { background-color: var(--primary-color); border: none; }
        .btn-accent { background-color: var(--accent-color); color: white; }
        .cart-badge { position: absolute; top: -5px; right: -10px; background: var(--accent-color); color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .section-title { border-bottom: 3px solid var(--accent-color); display: inline-block; margin-bottom: 20px; }
    </style>
</head>
<body>

<!-- Loader -->
<div id="loading">
    <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
</div>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
        <a class="navbar-brand" href="#">BRAND LOGO</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link active" href="#" onclick="showPage('home')">Shop</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('track')">Track Order</a></li>
                <li class="nav-item position-relative">
                    <a class="nav-link" href="#" onclick="showPage('cart')">
                        <i class="fas fa-shopping-cart"></i> <span id="cart-count" class="cart-badge">0</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Container -->
<div class="container my-5">
    
    <!-- Alerts -->
    <div id="alert-area"></div>

    <!-- HOME PAGE (Product Grid) -->
    <div id="home-page" class="page-section">
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h2 class="section-title">Our Products</h2>
            </div>
            <div class="col-md-6">
                <input type="text" id="search-bar" class="form-control" placeholder="Search products..." onkeyup="filterProducts()">
            </div>
        </div>
        <div class="row" id="product-grid">
            <!-- Products injected via JS -->
        </div>
    </div>

    <!-- CART PAGE -->
    <div id="cart-page" class="page-section d-none">
        <h2 class="section-title">Your Cart</h2>
        <div class="table-responsive">
            <table class="table align-middle">
                <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Total</th><th>Action</th></tr></thead>
                <tbody id="cart-items"></tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end">
            <h4>Total: $<span id="cart-total">0</span></h4>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-secondary me-2" onclick="showPage('home')">Continue Shopping</button>
            <button class="btn btn-success" onclick="showPage('checkout')">Proceed to Checkout</button>
        </div>
    </div>

    <!-- CHECKOUT PAGE -->
    <div id="checkout-page" class="page-section d-none">
        <h2 class="section-title">Checkout</h2>
        <div class="row">
            <div class="col-md-6">
                <form id="checkout-form" onsubmit="processOrder(event)">
                    <div class="mb-3">
                        <label>Full Name</label>
                        <input type="text" class="form-control" id="c-name" required>
                    </div>
                    <div class="mb-3">
                        <label>Phone Number</label>
                        <input type="tel" class="form-control" id="c-phone" required>
                    </div>
                    <div class="mb-3">
                        <label>Shipping Address</label>
                        <textarea class="form-control" id="c-address" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label>Payment Method</label>
                        <select class="form-control" required>
                            <option value="cod">Cash on Delivery</option>
                            <option value="bank">Bank Transfer</option>
                        </select>
                        <small class="text-muted">Secure payment processing via invoice.</small>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Place Order</button>
                </form>
            </div>
            <div class="col-md-6">
                <div class="card bg-light p-3">
                    <h5>Order Summary</h5>
                    <ul id="summary-list" class="list-group mb-3"></ul>
                    <h5>Total: $<span id="summary-total"></span></h5>
                </div>
            </div>
        </div>
    </div>

    <!-- ORDER SUCCESS -->
    <div id="success-page" class="page-section d-none text-center">
        <i class="fas fa-check-circle text-success fa-5x mb-3"></i>
        <h2>Order Placed Successfully!</h2>
        <p class="lead">Please save your Order ID: <strong id="final-order-id" class="text-primary"></strong></p>
        <p>You can use this ID to track your order status.</p>
        <button class="btn btn-primary" onclick="location.reload()">Back to Home</button>
    </div>

    <!-- TRACKING PAGE -->
    <div id="track-page" class="page-section d-none">
        <h2 class="section-title">Track Order</h2>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <input type="text" id="track-input" class="form-control" placeholder="Enter Order ID (e.g. ORD-1234)">
                    <button class="btn btn-primary" onclick="trackOrder()">Search</button>
                </div>
                <div id="track-result" class="card p-4 d-none">
                    <h4>Order Status</h4>
                    <hr>
                    <p><strong>Status:</strong> <span id="t-status" class="badge bg-info"></span></p>
                    <p><strong>Total Amount:</strong> $<span id="t-total"></span></p>
                    <p><strong>Date:</strong> <span id="t-date"></span></p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center p-3 mt-5">
    <p>&copy; 2024 My Business. All Rights Reserved.</p>
</footer>

<!-- JS Logic -->
<script>
    // ******* CONFIGURATION *******
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhtsYfzJfDUYn3MYec3Ul_7fHVf2J7LBFMH-LCvFeBUFfuu-4wqbSGCNKUbzDFVI6k/exec"; // PASTE YOUR GOOGLE APPS SCRIPT URL HERE
    // *****************************

    let products = [];
    let cart = JSON.parse(localStorage.getItem('myCart')) || [];

    // Initialize
    document.addEventListener("DOMContentLoaded", () => {
        fetchProducts();
        updateCartUI();
    });

    function showLoader(show) {
        document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }

    function showAlert(msg, type='success') {
        const div = document.createElement('div');
        div.className = `alert alert-${type} alert-dismissible fade show`;
        div.innerHTML = `${msg} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
        document.getElementById('alert-area').appendChild(div);
        setTimeout(() => div.remove(), 3000);
    }

    function showPage(pageId) {
        document.querySelectorAll('.page-section').forEach(el => el.classList.add('d-none'));
        if(pageId === 'home') document.getElementById('home-page').classList.remove('d-none');
        if(pageId === 'cart') { document.getElementById('cart-page').classList.remove('d-none'); renderCartPage(); }
        if(pageId === 'checkout') { 
            if(cart.length === 0) return showAlert('Cart is empty', 'danger');
            document.getElementById('checkout-page').classList.remove('d-none'); 
            renderCheckoutSummary(); 
        }
        if(pageId === 'track') document.getElementById('track-page').classList.remove('d-none');
    }

    // --- API CALLS ---
    
    function fetchProducts() {
        showLoader(true);
        fetch(`${SCRIPT_URL}?action=getProducts`)
            .then(res => res.json())
            .then(data => {
                products = data;
                renderProducts(products);
                showLoader(false);
            })
            .catch(err => {
                console.error(err);
                showLoader(false);
                showAlert("Error fetching products", "danger");
            });
    }

    // --- HOME / PRODUCT LOGIC ---

    function renderProducts(list) {
        const grid = document.getElementById('product-grid');
        grid.innerHTML = '';
        list.forEach(p => {
            grid.innerHTML += `
                <div class="col-md-4 col-sm-6 mb-4">
                    <div class="card h-100">
                        <img src="${p.image}" class="card-img-top" style="height:200px; object-fit:cover;" alt="${p.name}">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">${p.name}</h5>
                            <p class="text-muted">${p.category}</p>
                            <p class="card-text">${p.desc}</p>
                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                <h4 class="text-primary mb-0">$${p.price}</h4>
                                <button class="btn btn-outline-primary" onclick="addToCart('${p.id}')">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function filterProducts() {
        const term = document.getElementById('search-bar').value.toLowerCase();
        const filtered = products.filter(p => p.name.toLowerCase().includes(term) || p.category.toLowerCase().includes(term));
        renderProducts(filtered);
    }

    // --- CART LOGIC ---

    function addToCart(id) {
        const product = products.find(p => p.id == id);
        const existing = cart.find(item => item.id == id);
        if (existing) {
            existing.qty++;
        } else {
            cart.push({ ...product, qty: 1 });
        }
        updateCartUI();
        showAlert(`${product.name} added to cart!`);
    }

    function updateCartUI() {
        localStorage.setItem('myCart', JSON.stringify(cart));
        const count = cart.reduce((acc, item) => acc + item.qty, 0);
        document.getElementById('cart-count').innerText = count;
    }

    function renderCartPage() {
        const tbody = document.getElementById('cart-items');
        tbody.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.qty;
            total += itemTotal;
            tbody.innerHTML += `
                <tr>
                    <td>${item.name}</td>
                    <td>$${item.price}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="changeQty(${index}, -1)">-</button>
                        <span class="mx-2">${item.qty}</span>
                        <button class="btn btn-sm btn-secondary" onclick="changeQty(${index}, 1)">+</button>
                    </td>
                    <td>$${itemTotal}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})"><i class="fas fa-trash"></i></button></td>
                </tr>
            `;
        });
        document.getElementById('cart-total').innerText = total;
    }

    function changeQty(index, delta) {
        cart[index].qty += delta;
        if (cart[index].qty < 1) cart[index].qty = 1;
        updateCartUI();
        renderCartPage();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
        renderCartPage();
    }

    // --- CHECKOUT & ORDER LOGIC ---

    function renderCheckoutSummary() {
        const list = document.getElementById('summary-list');
        list.innerHTML = '';
        let total = 0;
        cart.forEach(item => {
            total += item.price * item.qty;
            list.innerHTML += `<li class="list-group-item d-flex justify-content-between">
                <span>${item.name} (x${item.qty})</span>
                <span>$${item.price * item.qty}</span>
            </li>`;
        });
        document.getElementById('summary-total').innerText = total;
    }

    function processOrder(e) {
        e.preventDefault();
        showLoader(true);

        const orderData = {
            action: 'placeOrder',
            customer: {
                name: document.getElementById('c-name').value,
                phone: document.getElementById('c-phone').value,
                address: document.getElementById('c-address').value
            },
            cart: cart,
            total: document.getElementById('summary-total').innerText
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(orderData)
        })
        .then(res => res.json())
        .then(data => {
            showLoader(false);
            if(data.status === 'success') {
                cart = [];
                updateCartUI();
                document.getElementById('checkout-page').classList.add('d-none');
                document.getElementById('success-page').classList.remove('d-none');
                document.getElementById('final-order-id').innerText = data.orderId;
            }
        })
        .catch(err => {
            console.error(err);
            showLoader(false);
            showAlert("Order Failed", "danger");
        });
    }

    // --- TRACKING LOGIC ---

    function trackOrder() {
        const id = document.getElementById('track-input').value.trim();
        if(!id) return showAlert("Please enter an Order ID", "warning");
        
        showLoader(true);
        fetch(`${SCRIPT_URL}?action=trackOrder&orderId=${id}`)
            .then(res => res.json())
            .then(data => {
                showLoader(false);
                const resBox = document.getElementById('track-result');
                if(data.status === 'found') {
                    resBox.classList.remove('d-none');
                    document.getElementById('t-status').innerText = data.currStatus;
                    document.getElementById('t-total').innerText = data.total;
                    document.getElementById('t-date').innerText = new Date(data.date).toLocaleDateString();
                } else {
                    resBox.classList.add('d-none');
                    showAlert("Order ID not found", "danger");
                }
            });
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
