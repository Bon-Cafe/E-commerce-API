<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Al-Jazaa Ph. | Elegant Modest Wear</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
    :root {
        --primary: #1b4d3e; /* Elegant Green */
        --gold: #c5a059; /* Gold Accent */
        --bg: #F9F9F7; /* Off White */
        --grey: #F0F0F0;
        --dark: #2d2d2d;
    }

    /* Reset & Base */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: 'Lato', sans-serif; background: var(--bg); color: var(--dark); overflow-x: hidden; }
    h1, h2, h3, h4 { font-family: 'Playfair Display', serif; margin: 0; }
    
    /* Utilities */
    .d-none { display: none !important; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .btn { cursor: pointer; border: none; padding: 12px 30px; font-weight: bold; letter-spacing: 1px; transition: 0.3s; font-size: 0.9rem; text-transform: uppercase; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: #13382d; transform: translateY(-2px); }
    .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }
    
    /* Navbar */
    nav { background: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 20px rgba(0,0,0,0.05); }
    .logo { font-size: 1.8rem; font-weight: 700; color: var(--primary); text-decoration: none; }
    .nav-menu a { margin-left: 20px; text-decoration: none; color: var(--dark); font-size: 0.95rem; }
    .nav-menu a:hover { color: var(--primary); }
    .cart-btn { position: relative; cursor: pointer; }
    .cart-badge { position: absolute; top: -8px; right: -10px; background: var(--gold); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; justify-content: center; align-items: center; }

    /* Shop Layout */
    .shop-layout { display: flex; gap: 40px; margin-top: 30px; }
    
    /* Sidebar */
    .sidebar { width: 220px; flex-shrink: 0; height: calc(100vh - 100px); position: sticky; top: 90px; overflow-y: auto; padding-right: 10px; border-right: 1px solid #eee; }
    .sidebar h4 { color: var(--gold); margin-bottom: 20px; border-bottom: 2px solid var(--gold); display: inline-block; padding-bottom: 5px; }
    .cat-btn { display: block; width: 100%; text-align: left; padding: 12px 0; background: none; border: none; color: #666; font-size: 1rem; cursor: pointer; transition: 0.3s; border-bottom: 1px solid #f5f5f5; }
    .cat-btn:hover, .cat-btn.active { color: var(--primary); font-weight: bold; padding-left: 10px; }

    /* Product Grid */
    .grid { flex-grow: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px; align-content: start; }
    .card { background: white; transition: 0.3s; cursor: pointer; position: relative; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
    .card-img { width: 100%; height: 280px; object-fit: cover; }
    .card-info { padding: 15px; text-align: center; }
    .stock-badge { position: absolute; top: 10px; right: 10px; padding: 5px 12px; font-size: 0.75rem; color: white; font-weight: bold; text-transform: uppercase; }
    .bg-in { background: var(--primary); }
    .bg-out { background: #999; }

    /* Product Detail Page */
    #product-page { position: fixed; inset: 0; background: white; z-index: 200; overflow-y: auto; padding-bottom: 50px; }
    .back-btn { margin: 20px; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; max-width: 1000px; margin: 0 auto; padding: 20px; }
    .detail-img { width: 100%; height: 500px; object-fit: cover; border: 1px solid #eee; }
    
    /* Slant Options */
    .opt-group { margin: 25px 0; }
    .opt-label { font-weight: bold; font-size: 0.9rem; text-transform: uppercase; color: #777; margin-bottom: 10px; display: block; }
    .slant-container { display: flex; flex-wrap: wrap; gap: 15px; }
    .slant-box {
        border: 1px solid #ccc;
        padding: 10px 20px;
        min-width: 50px;
        text-align: center;
        transform: skewX(-15deg);
        cursor: pointer;
        transition: 0.2s;
        background: white;
    }
    .slant-box span { display: block; transform: skewX(15deg); font-weight: 600; }
    .slant-box.selected { background: var(--primary); color: white; border-color: var(--primary); }
    .slant-box:hover:not(.selected) { background: #f4f4f4; }

    /* Cart & Checkout */
    .table-container { background: white; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .cart-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0; }
    .checkout-form { max-width: 600px; margin: 0 auto; background: white; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #555; }
    .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; font-family: inherit; }
    
    /* Toast Notification */
    #toast { 
        visibility: hidden; min-width: 250px; background-color: var(--primary); color: #fff; 
        text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 3000; 
        left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    #toast.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    /* Loader */
    #loader { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 5000; display: flex; justify-content: center; align-items: center; }
    
    /* Mobile */
    @media(max-width: 768px) {
        .shop-layout { flex-direction: column; }
        .sidebar { width: 100%; height: auto; position: static; white-space: nowrap; overflow-x: auto; padding: 10px 0; border: none; }
        .cat-btn { display: inline-block; width: auto; padding: 5px 15px; margin-right: 10px; background: #fff; border: 1px solid #eee; border-radius: 20px; }
        .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .detail-grid { grid-template-columns: 1fr; }
        .detail-img { height: 350px; }
    }
</style>
</head>
<body>

<!-- Loader -->
<div id="loader"><i class="fas fa-spinner fa-spin fa-2x" style="color:var(--primary)"></i></div>

<!-- Toast -->
<div id="toast">Item Added to Cart</div>

<!-- Navigation -->
<nav>
    <a href="#" onclick="showShop()" class="logo">Al-Jazaa Ph.</a>
    <div class="nav-menu">
        <a href="#" onclick="showShop()">Shop</a>
        <a href="#" onclick="showTrack()">Track Order</a>
        <a href="#" onclick="showCart()" class="cart-btn">
            <i class="fas fa-shopping-bag fa-lg"></i>
            <span id="cart-count" class="cart-badge">0</span>
        </a>
    </div>
</nav>

<div class="container">

    <!-- HOME / SHOP PAGE -->
    <div id="page-shop" class="page-section">
        <div class="shop-layout">
            <!-- Sidebar -->
            <div class="sidebar">
                <h4>Categories</h4>
                <div id="category-container">
                    <!-- Categories injected here -->
                </div>
            </div>
            
            <!-- Products -->
            <div id="product-container" class="grid">
                <!-- Products injected here -->
            </div>
        </div>
    </div>

    <!-- CART PAGE -->
    <div id="page-cart" class="page-section d-none">
        <h2 style="margin: 30px 0;">Your Shopping Cart</h2>
        <div class="table-container">
            <div id="cart-items"></div>
            <div style="text-align: right; margin-top: 30px;">
                <h3>Total: <span id="cart-total">$0.00</span></h3>
                <br>
                <button class="btn btn-outline" onclick="showShop()">Continue Shopping</button>
                <button class="btn btn-primary" onclick="showCheckout()">Checkout (GCash)</button>
            </div>
        </div>
    </div>

    <!-- CHECKOUT PAGE -->
    <div id="page-checkout" class="page-section d-none">
        <h2 style="text-align:center; margin: 30px 0;">Checkout</h2>
        <form class="checkout-form" onsubmit="processOrder(event)">
            <h4>Shipping Info</h4>
            <div class="form-group"><label>Name</label><input id="c-name" required></div>
            <div class="form-group"><label>Phone</label><input id="c-phone" type="tel" required></div>
            <div class="form-group"><label>Address</label><textarea id="c-addr" rows="3" required></textarea></div>
            
            <hr style="margin: 30px 0;">
            
            <h4>Payment (GCash)</h4>
            <div style="background: #e6fffa; padding: 15px; border: 1px solid #1b4d3e; color: #1b4d3e; margin-bottom: 15px;">
                <strong>Send Total to GCash: 09XX-XXX-XXXX</strong><br>
                <small>Account Name: Al-Jazaa Ph.</small>
            </div>
            <div class="form-group">
                <label>Reference Number</label>
                <input id="c-ref" placeholder="Enter Reference No. (Required)" required>
            </div>

            <button type="submit" class="btn btn-primary" style="width:100%">Place Order</button>
            <button type="button" class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="showCart()">Back to Cart</button>
        </form>
    </div>

    <!-- TRACK PAGE -->
    <div id="page-track" class="page-section d-none" style="max-width:600px; margin: 50px auto; text-align:center;">
        <h2>Track Your Order</h2>
        <div style="margin-top:20px; display:flex; gap:10px;">
            <input id="track-input" class="form-control" placeholder="Enter Order ID (e.g. ALJ-12345)" style="padding:10px; width:100%;">
            <button class="btn btn-primary" onclick="trackOrder()">Track</button>
        </div>
        <div id="track-res" class="card d-none" style="padding:20px; margin-top:20px; text-align:left;">
            <p><strong>Status:</strong> <span id="t-status"></span></p>
            <p><strong>Date:</strong> <span id="t-date"></span></p>
            <p><strong>Total:</strong> <span id="t-total"></span></p>
        </div>
    </div>

</div>

<!-- PRODUCT OVERLAY (POPUP) -->
<div id="product-page" class="d-none">
    <div class="back-btn" onclick="closeProduct()"><i class="fas fa-arrow-left"></i> Back to Shopping</div>
    <div class="detail-grid">
        <img id="detail-img" src="" class="detail-img">
        <div>
            <h1 id="detail-title" style="color:var(--primary)">Product Name</h1>
            <h3 id="detail-price" style="color:#666; margin: 10px 0;">$0.00</h3>
            <p id="detail-desc" style="line-height:1.6; color:#555;">Desc</p>
            
            <hr>

            <!-- Options -->
            <div class="opt-group">
                <span class="opt-label">Select Size</span>
                <div class="slant-container" id="size-options">
                    <div class="slant-box" onclick="pick('size','S',this)"><span>S</span></div>
                    <div class="slant-box" onclick="pick('size','M',this)"><span>M</span></div>
                    <div class="slant-box" onclick="pick('size','L',this)"><span>L</span></div>
                    <div class="slant-box" onclick="pick('size','XL',this)"><span>XL</span></div>
                    <div class="slant-box" onclick="pick('size','XXL',this)"><span>XXL</span></div>
                </div>
            </div>

            <div class="opt-group">
                <span class="opt-label">Select Height</span>
                <div class="slant-container" id="height-options">
                    <!-- Heights 4'0 to 5'9 generated via JS -->
                </div>
            </div>

            <!-- Action -->
            <button id="add-cart-btn" class="btn btn-primary" style="width:100%; padding: 15px; font-size:1.1rem; margin-top:20px;" onclick="addToCart()">
                ADD TO CART
            </button>
        </div>
    </div>
</div>

<script>
    // *** SETUP ***
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhtsYfzJfDUYn3MYec3Ul_7fHVf2J7LBFMH-LCvFeBUFfuu-4wqbSGCNKUbzDFVI6k/exec"; // <--- PASTE YOUR LINK HERE
    // *************

    let products = [];
    let cart = JSON.parse(localStorage.getItem('alj_cart')) || [];
    let currentProd = {};
    let selections = { size: "", height: "" };

    window.onload = function() {
        genHeights();
        fetchProducts();
        updateBadge();
    };

    // --- NAVIGATION ---
    function hideAll() {
        document.querySelectorAll('.page-section').forEach(el => el.classList.add('d-none'));
        document.getElementById('product-page').classList.add('d-none');
    }
    function showShop() { hideAll(); document.getElementById('page-shop').classList.remove('d-none'); }
    function showCart() { hideAll(); document.getElementById('page-cart').classList.remove('d-none'); renderCart(); }
    function showCheckout() { hideAll(); document.getElementById('page-checkout').classList.remove('d-none'); }
    function showTrack() { hideAll(); document.getElementById('page-track').classList.remove('d-none'); }
    function closeProduct() { document.getElementById('product-page').classList.add('d-none'); }

    // --- GENERATORS ---
    function genHeights() {
        const heights = [];
        for(let f=4; f<=5; f++) {
            for(let i=0; i<=11; i++) {
                if(f===5 && i>9) break; 
                heights.push(`${f}'${i}"`);
            }
        }
        const box = document.getElementById('height-options');
        box.innerHTML = heights.map(h => `<div class="slant-box" onclick="pick('height','${h}',this)"><span>${h}</span></div>`).join('');
    }

    // --- DATA ---
    function fetchProducts() {
        fetch(SCRIPT_URL + "?action=getProducts")
        .then(res => res.json())
        .then(data => {
            products = data;
            document.getElementById('loader').classList.add('d-none');
            renderCats();
            renderProds(products);
        })
        .catch(err => alert("Error loading products. Check your Internet or Script URL."));
    }

    function renderCats() {
        const cats = ["All", ...new Set(products.map(p => p.category))];
        const bar = document.getElementById('category-container');
        bar.innerHTML = cats.map(c => 
            `<button class="cat-btn ${c==='All'?'active':''}" onclick="filter('${c}', this)">${c}</button>`
        ).join('');
    }

    function filter(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const list = cat === 'All' ? products : products.filter(p => p.category === cat);
        renderProds(list);
    }

    function renderProds(list) {
        const grid = document.getElementById('product-container');
        grid.innerHTML = list.map(p => `
            <div class="card animate__animated animate__fadeIn" onclick="openDetail('${p.id}')">
                <span class="stock-badge ${p.inStock ? 'bg-in' : 'bg-out'}">${p.inStock ? 'In Stock' : 'Out of Stock'}</span>
                <img src="${p.image}" class="card-img" alt="${p.name}">
                <div class="card-info">
                    <h3 style="font-size:1rem; margin-bottom:5px;">${p.name}</h3>
                    <div style="color:#666;">${p.category}</div>
                    <div style="color:var(--primary); font-weight:bold; margin-top:5px;">$${p.price}</div>
                </div>
            </div>
        `).join('');
    }

    // --- PRODUCT DETAIL ---
    function openDetail(id) {
        currentProd = products.find(p => p.id == id);
        selections = { size: "", height: "" }; // Reset selections
        
        // Reset Visuals
        document.querySelectorAll('.slant-box').forEach(b => b.classList.remove('selected'));
        
        document.getElementById('detail-img').src = currentProd.image;
        document.getElementById('detail-title').innerText = currentProd.name;
        document.getElementById('detail-price').innerText = "$" + currentProd.price;
        document.getElementById('detail-desc').innerText = currentProd.desc;
        
        const btn = document.getElementById('add-cart-btn');
        if(currentProd.inStock) {
            btn.disabled = false;
            btn.innerText = "ADD TO CART";
            btn.classList.remove('bg-out');
            btn.classList.add('btn-primary');
        } else {
            btn.disabled = true;
            btn.innerText = "OUT OF STOCK";
            btn.classList.remove('btn-primary');
            btn.classList.add('bg-out');
        }

        document.getElementById('product-page').classList.remove('d-none');
    }

    function pick(type, val, el) {
        // Remove 'selected' class from siblings in same container
        let parent = el.parentNode;
        Array.from(parent.children).forEach(c => c.classList.remove('selected'));
        
        // Add to clicked
        el.classList.add('selected');
        selections[type] = val;
        console.log("Selected: ", selections);
    }

    function addToCart() {
        // Validation
        if(!selections.size || !selections.height) {
            alert("Please select both SIZE and HEIGHT to proceed.");
            return;
        }

        // Add
        cart.push({
            id: currentProd.id,
            name: currentProd.name,
            price: currentProd.price,
            image: currentProd.image,
            size: selections.size,
            height: selections.height,
            qty: 1
        });
        
        localStorage.setItem('alj_cart', JSON.stringify(cart));
        updateBadge();
        
        // Toast Effect
        const x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        
        setTimeout(() => {
            closeProduct();
        }, 1000); // Wait 1 sec then close
    }

    // --- CART LOGIC ---
    function updateBadge() { document.getElementById('cart-count').innerText = cart.length; }

    function renderCart() {
        const div = document.getElementById('cart-items');
        div.innerHTML = "";
        let total = 0;
        
        if(cart.length === 0) {
            div.innerHTML = "<p>Cart is empty.</p>";
            document.getElementById('cart-total').innerText = "$0.00";
            return;
        }

        cart.forEach((item, idx) => {
            total += (item.price * 1);
            div.innerHTML += `
                <div class="cart-row">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <img src="${item.image}" style="width:60px; height:60px; object-fit:cover;">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>${item.size} / ${item.height}</small>
                        </div>
                    </div>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <strong>$${item.price}</strong>
                        <button onclick="remItem(${idx})" style="background:none; border:none; color:red;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
        });
        document.getElementById('cart-total').innerText = "$" + total;
    }

    function remItem(idx) {
        cart.splice(idx, 1);
        localStorage.setItem('alj_cart', JSON.stringify(cart));
        renderCart();
        updateBadge();
    }

    function processOrder(e) {
        e.preventDefault();
        document.getElementById('loader').classList.remove('d-none');
        
        const payload = {
            action: 'placeOrder',
            customer: {
                name: document.getElementById('c-name').value,
                phone: document.getElementById('c-phone').value,
                address: document.getElementById('c-addr').value
            },
            payment: { ref: document.getElementById('c-ref').value },
            cart: cart,
            total: document.getElementById('cart-total').innerText
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('loader').classList.add('d-none');
            if(data.status === 'success') {
                alert("Order Placed Successfully! Your Order ID is: " + data.orderId);
                cart = [];
                localStorage.removeItem('alj_cart');
                window.location.reload();
            } else {
                alert("Failed: " + data.msg);
            }
        });
    }

    function trackOrder() {
        const id = document.getElementById('track-input').value;
        if(!id) return;
        document.getElementById('loader').classList.remove('d-none');
        fetch(SCRIPT_URL + `?action=trackOrder&orderId=${id}`)
        .then(res => res.json())
        .then(data => {
            document.getElementById('loader').classList.add('d-none');
            const box = document.getElementById('track-res');
            box.classList.remove('d-none');
            if(data.status === 'found') {
                document.getElementById('t-status').innerText = data.currStatus;
                document.getElementById('t-date').innerText = data.date;
                document.getElementById('t-total').innerText = data.total;
            } else {
                box.innerHTML = "<p>Order not found. Please check ID.</p>";
            }
        });
    }
</script>
</body>
</html>
